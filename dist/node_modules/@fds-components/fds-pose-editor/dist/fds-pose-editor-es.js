function e(){}function t(e){return e()}function o(){return Object.create(null)}function n(e){e.forEach(t)}function r(e){return"function"==typeof e}function a(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function i(e,t,o){e.insertBefore(t,o||null)}function s(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t,o){null==o?e.removeAttribute(t):e.getAttribute(t)!==o&&e.setAttribute(t,o)}function l(e){const t={};for(const o of e)t[o.name]=o.value;return t}let d;function h(e){d=e}function u(){if(!d)throw new Error("Function called outside component initialization");return d}const g=[],m=[];let f=[];const p=[],b=Promise.resolve();let $=!1;function B(e){f.push(e)}const C=new Set;let w=0;function _(){if(0!==w)return;const e=d;do{try{for(;w<g.length;){const e=g[w];w++,h(e),N(e.$$)}}catch(e){throw g.length=0,w=0,e}for(h(null),g.length=0,w=0;m.length;)m.pop()();for(let e=0;e<f.length;e+=1){const t=f[e];C.has(t)||(C.add(t),t())}f.length=0}while(g.length);for(;p.length;)p.pop()();$=!1,C.clear(),h(e)}function N(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(B)}}const L=new Set;function x(e,t){const o=e.$$;null!==o.fragment&&(!function(e){const t=[],o=[];f.forEach((n=>-1===e.indexOf(n)?t.push(n):o.push(n))),o.forEach((e=>e())),f=t}(o.after_update),n(o.on_destroy),o.fragment&&o.fragment.d(t),o.on_destroy=o.fragment=null,o.ctx=[])}function y(e,t){-1===e.$$.dirty[0]&&(g.push(e),$||($=!0,b.then(_)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function O(a,i,c,l,u,g,m,f=[-1]){const p=d;h(a);const b=a.$$={fragment:null,ctx:[],props:g,update:e,not_equal:u,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(p?p.$$.context:[])),callbacks:o(),dirty:f,skip_bound:!1,root:i.target||p.$$.root};m&&m(b.root);let $=!1;if(b.ctx=c?c(a,i.props||{},((e,t,...o)=>{const n=o.length?o[0]:t;return b.ctx&&u(b.ctx[e],b.ctx[e]=n)&&(!b.skip_bound&&b.bound[e]&&b.bound[e](n),$&&y(a,e)),t})):[],b.update(),$=!0,n(b.before_update),b.fragment=!!l&&l(b.ctx),i.target){if(i.hydrate){const e=function(e){return Array.from(e.childNodes)}(i.target);b.fragment&&b.fragment.l(e),e.forEach(s)}else b.fragment&&b.fragment.c();i.intro&&((C=a.$$.fragment)&&C.i&&(L.delete(C),C.i(w))),function(e,o,a,i){const{fragment:s,after_update:c}=e.$$;s&&s.m(o,a),i||B((()=>{const o=e.$$.on_mount.map(t).filter(r);e.$$.on_destroy?e.$$.on_destroy.push(...o):n(o),e.$$.on_mount=[]})),c.forEach(B)}(a,i.target,i.anchor,i.customElement),_()}var C,w;h(p)}let v;"function"==typeof HTMLElement&&(v=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(r);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,o){this[e]=o}disconnectedCallback(){n(this.$$.on_disconnect)}$destroy(){x(this,1),this.$destroy=e}$on(t,o){if(!r(o))return e;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(o),()=>{const e=n.indexOf(o);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});let A=import.meta.url;class S{static async getInfo(e,t){let o="",n="",r=!1;t&&(t=t.replace("@fds-components/",""),o=S.get_href()+e+"-"+t+".json",n=`@fds-components/${t}/dist/${e}-${t}.json`);let a=await fetch(o).then((e=>(e.ok||(r=!0),e.json()))).then((t=>"api"!==e?t:t?t.components?t.components[0]:t:void 0));return r&&(a=await fetch(n).then((e=>(e.ok||(r=!0),e.json()))).then((t=>"api"!==e?t:t?t.components?t.components[0]:t:void 0))),a}static get_href(){return new URL("./",A).href}static get_local(){return new URL("./",A).pathname}}var Y="@fds-components/fds-pose-editor",k="1.0.20";function j(t){let o;return{c(){o=function(e){return document.createElement(e)}("canvas"),this.c=e,c(o,"id","renderCanvas"),c(o,"width",t[1]),c(o,"height",t[2]),c(o,"class","canvas")},m(e,n){i(e,o,n),t[24](o)},p(e,t){2&t[0]&&c(o,"width",e[1]),4&t[0]&&c(o,"height",e[2])},i:e,o:e,d(e){e&&s(o),t[24](null)}}}async function E(e){const t=await new Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`});await t.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults((e=>{})),await t.reset(),await t.send({image:e})}function M(e,t){if(e)for(let o of e)o.visibility=t?1:1e-5}function z(e,t,o){let n=S.get_href(),r=u(),{width:a=1e3}=t,{height:i=1e3}=t,s=!0,{external_scene_storage:c=null}=t,{show_character:l="human"}=t,{camera_behaviour:d=""}=t;const h=k;var g;let f;g=()=>()=>{c&&o(5,c.data=L(),c)},u().$$.on_mount.push(g);let{scene:p}=t,b=[];let $=function(){return new Promise((e=>{setTimeout((()=>{e("")}),100)}))};let B={top:{boneColor:"#00009b",jointColor:"#9e323a"},"Shoulder L":{boneColor:"#993300",jointColor:""},"Shoulder R":{boneColor:"#990000",jointColor:""},"UpperArm L":{boneColor:"#669900",jointColor:"#349c00"},"UpperArm R":{boneColor:"#996600",jointColor:"#916100"},"LowerArm L":{boneColor:"#339900",jointColor:"#008400"},"LowerArm R":{boneColor:"#999900",jointColor:"#9a9900"},"Wrist L":{boneColor:"#009999",jointColor:""},"Wrist R":{boneColor:"#009900",jointColor:""},"UpperLeg L":{boneColor:"#006699",jointColor:"#003194"},"UpperLeg R":{boneColor:"#009933",jointColor:"#00a767"},"LowerLeg L":{boneColor:"#003399",jointColor:"#0011b3"},"LowerLeg R":{boneColor:"#009966",jointColor:"#00a49d"},"Eye L":{boneColor:"#a200a3",jointColor:"#9f002e"},"Eye R":{boneColor:"#320099",jointColor:"#9f002e"},"Ear L":{boneColor:"#990066",jointColor:"#980098"},"Ear R":{boneColor:"#660099",jointColor:"#6a009f"},"Delete L":{boneColor:"",jointColor:"#980032"},"Delete R":{boneColor:"",jointColor:"#9c006a"},"Hand L":{boneColor:"",jointColor:"#009933"},"Hand R":{boneColor:"",jointColor:"#669900"},"Foot L":{boneColor:"",jointColor:"#330098"},"Foot R":{boneColor:"",jointColor:"#006598"}};function C(e,t){t.bones.forEach((function(t){if(!t.name.includes("neutral")&&!t.name.includes("Skelett")){let o=B[t.name],n="#FF0000";if(!(t.name.includes("Wrist")||t.name.includes("Shoulder")||t.name.includes("Finger")||t.name.includes("Thumb"))){const r=BABYLON.MeshBuilder.CreateSphere("joint_"+t.name,{segments:4,diameter:.04},p);r.attachToBone(t,e),r.bone=t,r.renderingGroupId=2,o&&o.jointColor&&(n=o.jointColor),r.material=new BABYLON.StandardMaterial("joint"),r.material.diffuseColor=BABYLON.Color3.FromHexString(n),r.renderForAI=!0,r.aiColor=BABYLON.Color3.FromHexString(n)}let r,a=[];t.children&&t.children[0]&&(r=t.children[0],a=[new BABYLON.Vector3(0,0,0),r.position]),n="#ffffff",o&&o.boneColor&&(n=o.boneColor);let i,s=function(e,t){let o=[];for(let n=0;n<t;n++){let r=n/t*Math.PI*2,a=e*Math.cos(r),i=e*Math.sin(r);o.push(new BABYLON.Vector3(a,i,0))}return o}(.015,5);!a.length||t.name.includes("Finger")||t.name.includes("Thumb")||t.name.includes("Hand")||(i=new BABYLON.MeshBuilder.ExtrudeShape("bone_"+t.name,{shape:s,closeShape:!0,path:a,sideOrientation:BABYLON.Mesh.DOUBLESIDE,updatable:!0},p),i.renderingGroupId=2,i.bone=t,i.child=r,i.attachToBone(t,e),i.material=new BABYLON.StandardMaterial("bone"),i.renderForAI=!0,i.aiColor=BABYLON.Color3.FromHexString(n),i.material.diffuseColor=BABYLON.Color3.FromHexString(n))}}))}let w={joints:{},root:{}};function _(){return function(){const e=BABYLON.Vector3.Zero(),t=BABYLON.Vector3.Zero(),o=BABYLON.Quaternion.Zero();A.getLocalMatrix().decompose(t,o,e),w.root={scaling:t.clone(),rotationQ:o.clone(),position:e.clone()};for(let n of p.meshes)n.name.includes("joint_")&&(n.bone.getLocalMatrix().decompose(t,o,e),w.joints[n.name]={scaling:t.clone(),rotationQ:o.clone(),position:e.clone()})}(),[JSON.parse(JSON.stringify(w))]}function N(e){w=e[0],function(){let e=A.getTransformNode(),t=w.root;e.rotationQuaternion=new BABYLON.Quaternion(t.rotationQ._x,t.rotationQ._y,t.rotationQ._z,t.rotationQ._w),e.position=new BABYLON.Vector3(t.position._x,t.position._y,t.position._z),e.scaling=new BABYLON.Vector3(t.scaling._x,t.scaling._y,t.scaling._z);for(let o of p.meshes)if(o.name.includes("joint_")){let n=o.bone;e=n.getTransformNode(),t=w.joints[o.name],e.rotationQuaternion=new BABYLON.Quaternion(t.rotationQ._x,t.rotationQ._y,t.rotationQ._z,t.rotationQ._w),e.position=new BABYLON.Vector3(t.position._x,t.position._y,t.position._z),e.scaling=new BABYLON.Vector3(t.scaling._x,t.scaling._y,t.scaling._z),e.rotationQuaternion?n.rotationQuaternion=e.rotationQuaternion:n.rotation=e.rotation,n.scaling=e.scaling}}()}function L(){let e={},t=p.activeCamera;return e.position=JSON.parse(JSON.stringify(t.position)),e.rotation=JSON.parse(JSON.stringify(t.rotation)),{cameraInfo:e,poseInfo:_()}}async function x(){let e=z;I(""),await $();let t=J.toDataURL();return I(e),t}let y,O,v,A,j,{mode:z=""}=t;function I(e){"edit_skeleton"===e&&y&&O&&(y&&(y.attachedNode=null),O&&(O.attachedNode=null),v&&(v.attachedNode=null)),"move_rotate"===e&&A&&(y.attachedNode=A.getTransformNode(),O.attachedNode=A.getTransformNode(),v&&(v.attachedNode=null)),"scale"===e&&y&&O&&(y.attachedNode=null,O.attachedNode=null,v&&(v.attachedNode=A.getTransformNode())),""===e&&y&&O&&(y.attachedNode=null,O.attachedNode=null,v.attachedNode=null)}function G(e){r.dispatchEvent(new CustomEvent("change",e))}let R,F,V,D=!1;let P,{background_type:Q="transparent"}=t,T=null;function U(e="grey"){p&&("transparent"===e&&(T&&(T.dispose(),T=null),o(4,p.clearColor=new BABYLON.Color4(0,0,0,0),p)),"grey"===e&&(T||(T=p.createDefaultEnvironment({enableGroundShadow:!0}),T.setMainColor(BABYLON.Color3.Gray()),T.ground.position.y+=.01),o(4,p.clearColor=P,p)),"black"===e&&(T&&(T.dispose(),T=null),o(4,p.clearColor=new BABYLON.Color4(0,0,0,255),p)))}function H(e){f=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0}),f.enableOfflineSupport=!1,f.resize(),BABYLON.Animation.AllowMatricesInterpolation=!0,o(4,p=new BABYLON.Scene(f)),P=p.clearColor;let t=new BABYLON.ArcRotateCamera("camera1",Math.PI/2,Math.PI/2,3,new BABYLON.Vector3(0,1,0),p);t.attachControl(e,!0),t.lowerRadiusLimit=1.2,t.upperRadiusLimit=8,t.wheelDeltaPercentage=.01,t.onViewMatrixChangedObservable.add((()=>{G({type:"camera",position:t.position,rotation:t.rotation})}));let r=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),p);r.intensity=.6,r.specular=BABYLON.Color3.Black();let a=new BABYLON.DirectionalLight("dir01",new BABYLON.Vector3(0,-.5,-1),p);a.position=new BABYLON.Vector3(0,5,5);let i=new BABYLON.ShadowGenerator(1024,a);i.useBlurExponentialShadowMap=!0,i.blurKernel=32;var c=new BABYLON.GridMaterial("groundMaterial",p);c.majorUnitFrequency=1,c.minorUnitVisibility=.1,c.gridRatio=1,c.backFaceCulling=!1,c.mainColor=new BABYLON.Color3(0,0,0),c.lineColor=new BABYLON.Color3(0,0,0),c.opacity=.2,BABYLON.Mesh.CreateGround("ground1",20,20,2,p).material=c,BABYLON.SceneLoader.ImportMesh("",n+"data/","dummy3.glb",p,(function(e,t,n){p.stopAllAnimations();var r=n[0],a=e[1];o(23,b=e),M(b,s),p.meshes.forEach((e=>{e.isPickable=!1})),i.addShadowCaster(p.meshes[0],!0);for(var c=0;c<e.length;c++)e[c].receiveShadows=!1;U(Q),C(a,r),function(e,t){R=BABYLON.MeshBuilder.CreateBox("box",{height:.06,width:.06,depth:.06}),R.renderingGroupId=2,R.isVisible=!1,A=t.bones[0];let n=new BABYLON.UtilityLayerRenderer(p);O=new BABYLON.PositionGizmo(n),y=new BABYLON.RotationGizmo(n),v=new BABYLON.ScaleGizmo(n),O.xGizmo.dragBehavior.onDragEndObservable.add((()=>{G({type:"position",axis:"x"})})),O.yGizmo.dragBehavior.onDragEndObservable.add((()=>{G({type:"position",axis:"y"})})),O.zGizmo.dragBehavior.onDragEndObservable.add((()=>{G({type:"position",axis:"z"})})),y.xGizmo.dragBehavior.onDragEndObservable.add((()=>{D=!1,R.isVisible=!1,G({type:"rotation",axis:"x"})})),y.yGizmo.dragBehavior.onDragEndObservable.add((()=>{D=!1,R.isVisible=!1,G({type:"rotation",axis:"y"})})),y.zGizmo.dragBehavior.onDragEndObservable.add((()=>{D=!1,R.isVisible=!1,G({type:"rotation",axis:"z"})})),y.xGizmo.dragBehavior.onDragStartObservable.add((()=>{V="x",R.rotation[V],D=!0})),y.yGizmo.dragBehavior.onDragStartObservable.add((()=>{V="y",R.rotation[V],D=!0})),y.zGizmo.dragBehavior.onDragStartObservable.add((()=>{V="z",R.rotation[V],D=!0})),v.xGizmo.dragBehavior.onDragEndObservable.add((()=>{G({type:"scale",axis:"x"})})),v.yGizmo.dragBehavior.onDragEndObservable.add((()=>{G({type:"scale",axis:"y"})})),v.zGizmo.dragBehavior.onDragEndObservable.add((()=>{G({type:"scale",axis:"z"})}));let r=new BABYLON.AxisScaleGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.FromHexString("#00b894"),n);r.attachedNode=null,y.updateGizmoRotationToMatchAttachedMesh=!0,y.updateGizmoPositionToMatchAttachedMesh=!0,O.updateGizmoPositionToMatchAttachedMesh=!0,F="",o(4,p.onPointerDown=function(){const e=p.pick(this.pointerX,this.pointerY);if(e.hit&&"edit_skeleton"===z){if(e.pickedMesh.name.includes("joint_")){let i=e.pickedMesh;if(i.name===F)y.attachedNode=null,F="";else{F=i.name,y.jointMesh=i,j=i.bone.getTransformNode(),R.position=i.bone.getTransformNode().absolutePosition,R.isVisible=!1,y.attachedNode=j,r.attachedNode=null;var t=j.getWorldMatrix(),o=new BABYLON.Quaternion,n=new BABYLON.Vector3,a=new BABYLON.Vector3;t.decompose(a,o,n);let e=o.toEulerAngles();R.rotation=e}}e.pickedMesh.name.includes("bone_")}},p)}((e[1],e[2]),r),f.hideLoadingUI(),function(e){e.runRenderLoop((function(){p&&p.activeCamera&&(D&&"edit_skeleton"===z&&R.rotation[V],p.render())}))}(f)}))}let{canvas:J}=t;return e.$$set=e=>{"width"in e&&o(1,a=e.width),"height"in e&&o(2,i=e.height),"external_scene_storage"in e&&o(5,c=e.external_scene_storage),"show_character"in e&&o(3,l=e.show_character),"camera_behaviour"in e&&o(6,d=e.camera_behaviour),"scene"in e&&o(4,p=e.scene),"mode"in e&&o(16,z=e.mode),"background_type"in e&&o(20,Q=e.background_type),"canvas"in e&&o(0,J=e.canvas)},e.$$.update=()=>{1&e.$$.dirty[0]&&J&&H(J),12582920&e.$$.dirty[0]&&(o(22,s="human"==l),M(b,s)),1048576&e.$$.dirty[0]&&Q&&U(Q),65536&e.$$.dirty[0]&&z&&I(z),81&e.$$.dirty[0]&&p&&(d||p.activeCamera.attachControl(J,!0),"lock"===d&&p.activeCamera.detachControl())},[J,a,i,l,p,c,d,async function(e){return"version"===e?new Promise((e=>{e(k)})):await S.getInfo(e,Y)},h,async function(){I("");let e=Q;U("black");let t=l;o(3,l="");for(let e of p.meshes)e.renderForAI&&(e.material.disableLighting=!0,e.material.emissiveColor=e.aiColor);await $(),o(3,l=t);let n=J.toDataURL();for(let e of p.meshes)e.renderForAI&&(e.material.disableLighting=!1,e.material.emissiveColor=BABYLON.Color3.FromHexString("#000000"));return U(e),n},_,N,async function(){let e=await x(),t={},o=p.activeCamera;return t.position=JSON.parse(JSON.stringify(o.position)),t.rotation=JSON.parse(JSON.stringify(o.rotation)),{cameraInfo:t,poseInfo:_(),image:e}},L,function(e){N(e.poseInfo);let t=p.activeCamera;t.position=e.cameraInfo.position,t.rotation=e.cameraInfo.rotation},x,z,I,E,function(e,t){let o=new BABYLON.Debug.SkeletonViewer(t,e,p);o.isEnabled=!0,o.color=BABYLON.Color3.Red()},Q,U,s,b,function(e){m[e?"unshift":"push"]((()=>{J=e,o(0,J)}))}]}class I extends v{constructor(e){super();const t=document.createElement("style");t.textContent=".canvas{width:100%;height:100%}*{box-sizing:border-box}",this.shadowRoot.appendChild(t),O(this,{target:this.shadowRoot,props:l(this.attributes),customElement:!0},z,j,a,{width:1,height:2,external_scene_storage:5,show_character:3,camera_behaviour:6,getInfo:7,version:8,scene:4,renderForAI:9,getPose:10,setPose:11,getScene:12,getSceneNoImage:13,setScene:14,renderNormal:15,mode:16,setMode:17,getPoseFromImage:18,addSkeletonViewer:19,background_type:20,setBackground:21,canvas:0},null,[-1,-1]),e&&(e.target&&i(e.target,this,e.anchor),e.props&&(this.$set(e.props),_()))}static get observedAttributes(){return["width","height","external_scene_storage","show_character","camera_behaviour","getInfo","version","scene","renderForAI","getPose","setPose","getScene","getSceneNoImage","setScene","renderNormal","mode","setMode","getPoseFromImage","addSkeletonViewer","background_type","setBackground","canvas"]}get width(){return this.$$.ctx[1]}set width(e){this.$$set({width:e}),_()}get height(){return this.$$.ctx[2]}set height(e){this.$$set({height:e}),_()}get external_scene_storage(){return this.$$.ctx[5]}set external_scene_storage(e){this.$$set({external_scene_storage:e}),_()}get show_character(){return this.$$.ctx[3]}set show_character(e){this.$$set({show_character:e}),_()}get camera_behaviour(){return this.$$.ctx[6]}set camera_behaviour(e){this.$$set({camera_behaviour:e}),_()}get getInfo(){return this.$$.ctx[7]}get version(){return this.$$.ctx[8]}get scene(){return this.$$.ctx[4]}set scene(e){this.$$set({scene:e}),_()}get renderForAI(){return this.$$.ctx[9]}get getPose(){return this.$$.ctx[10]}get setPose(){return this.$$.ctx[11]}get getScene(){return this.$$.ctx[12]}get getSceneNoImage(){return this.$$.ctx[13]}get setScene(){return this.$$.ctx[14]}get renderNormal(){return this.$$.ctx[15]}get mode(){return this.$$.ctx[16]}set mode(e){this.$$set({mode:e}),_()}get setMode(){return this.$$.ctx[17]}get getPoseFromImage(){return E}get addSkeletonViewer(){return this.$$.ctx[19]}get background_type(){return this.$$.ctx[20]}set background_type(e){this.$$set({background_type:e}),_()}get setBackground(){return this.$$.ctx[21]}get canvas(){return this.$$.ctx[0]}set canvas(e){this.$$set({canvas:e}),_()}}customElements.define("fds-pose-editor",I);export{I as default};
//# sourceMappingURL=fds-pose-editor-es.js.map
