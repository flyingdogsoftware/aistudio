var app=function(){"use strict";function e(){}function t(e){return e()}function o(){return Object.create(null)}function n(e){e.forEach(t)}function r(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function a(e,t,o){e.insertBefore(t,o||null)}function s(e){e.parentNode&&e.parentNode.removeChild(e)}function c(e,t,o){null==o?e.removeAttribute(t):e.getAttribute(t)!==o&&e.setAttribute(t,o)}function l(e){const t={};for(const o of e)t[o.name]=o.value;return t}let d;function u(e){d=e}function h(){if(!d)throw new Error("Function called outside component initialization");return d}const m=[],g=[];let f=[];const p=[],b=Promise.resolve();let $=!1;function B(e){f.push(e)}const w=new Set;let _=0;function C(){if(0!==_)return;const e=d;do{try{for(;_<m.length;){const e=m[_];_++,u(e),N(e.$$)}}catch(e){throw m.length=0,_=0,e}for(u(null),m.length=0,_=0;g.length;)g.pop()();for(let e=0;e<f.length;e+=1){const t=f[e];w.has(t)||(w.add(t),t())}f.length=0}while(m.length);for(;p.length;)p.pop()();$=!1,w.clear(),u(e)}function N(e){if(null!==e.fragment){e.update(),n(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(B)}}const L=new Set;function x(e,t){const o=e.$$;null!==o.fragment&&(!function(e){const t=[],o=[];f.forEach((n=>-1===e.indexOf(n)?t.push(n):o.push(n))),o.forEach((e=>e())),f=t}(o.after_update),n(o.on_destroy),o.fragment&&o.fragment.d(t),o.on_destroy=o.fragment=null,o.ctx=[])}function y(e,t){-1===e.$$.dirty[0]&&(m.push(e),$||($=!0,b.then(C)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function v(i,a,c,l,h,m,g,f=[-1]){const p=d;u(i);const b=i.$$={fragment:null,ctx:[],props:m,update:e,not_equal:h,bound:o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(p?p.$$.context:[])),callbacks:o(),dirty:f,skip_bound:!1,root:a.target||p.$$.root};g&&g(b.root);let $=!1;if(b.ctx=c?c(i,a.props||{},((e,t,...o)=>{const n=o.length?o[0]:t;return b.ctx&&h(b.ctx[e],b.ctx[e]=n)&&(!b.skip_bound&&b.bound[e]&&b.bound[e](n),$&&y(i,e)),t})):[],b.update(),$=!0,n(b.before_update),b.fragment=!!l&&l(b.ctx),a.target){if(a.hydrate){const e=function(e){return Array.from(e.childNodes)}(a.target);b.fragment&&b.fragment.l(e),e.forEach(s)}else b.fragment&&b.fragment.c();a.intro&&((w=i.$$.fragment)&&w.i&&(L.delete(w),w.i(_))),function(e,o,i,a){const{fragment:s,after_update:c}=e.$$;s&&s.m(o,i),a||B((()=>{const o=e.$$.on_mount.map(t).filter(r);e.$$.on_destroy?e.$$.on_destroy.push(...o):n(o),e.$$.on_mount=[]})),c.forEach(B)}(i,a.target,a.anchor,a.customElement),C()}var w,_;u(p)}let O;"function"==typeof HTMLElement&&(O=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const{on_mount:e}=this.$$;this.$$.on_disconnect=e.map(t).filter(r);for(const e in this.$$.slotted)this.appendChild(this.$$.slotted[e])}attributeChangedCallback(e,t,o){this[e]=o}disconnectedCallback(){n(this.$$.on_disconnect)}$destroy(){x(this,1),this.$destroy=e}$on(t,o){if(!r(o))return e;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(o),()=>{const e=n.indexOf(o);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}});let A=document.currentScript&&document.currentScript.src||new URL("fds-pose-editor.js",document.baseURI).href;class S{static async getInfo(e,t){let o="",n="",r=!1;t&&(t=t.replace("@fds-components/",""),o=S.get_href()+e+"-"+t+".json",n=`@fds-components/${t}/dist/${e}-${t}.json`);let i=await fetch(o).then((e=>(e.ok||(r=!0),e.json()))).then((t=>"api"!==e?t:t?t.components?t.components[0]:t:void 0));return r&&(i=await fetch(n).then((e=>(e.ok||(r=!0),e.json()))).then((t=>"api"!==e?t:t?t.components?t.components[0]:t:void 0))),i}static get_href(){return new URL("./",A).href}static get_local(){return new URL("./",A).pathname}}var Y="@fds-components/fds-pose-editor",j="1.0.24";function k(t){let o;return{c(){o=function(e){return document.createElement(e)}("canvas"),this.c=e,c(o,"id","renderCanvas"),c(o,"width",t[1]),c(o,"height",t[2]),c(o,"class","canvas")},m(e,n){a(e,o,n),t[24](o)},p(e,t){2&t[0]&&c(o,"width",e[1]),4&t[0]&&c(o,"height",e[2])},i:e,o:e,d(e){e&&s(o),t[24](null)}}}async function E(e){const t=await new Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`});await t.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!0,smoothSegmentation:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults((e=>{})),await t.reset(),await t.send({image:e})}function I(e,t){if(e)for(let o of e)o.visibility=t?1:1e-5}function M(e,t,o){let n=S.get_href(),r=h(),{width:i=1e3}=t,{height:a=1e3}=t,s=!0,{external_scene_storage:c=null}=t,{show_character:l="human"}=t,{camera_behaviour:d=""}=t;const u=j;var m;let f;m=()=>(setTimeout((async()=>{for(;window.in_3d_canvas_init;)await new Promise((e=>setTimeout(e,100)));window.in_3d_canvas_init=!0,function(e){f=new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0}),f.enableOfflineSupport=!1,f.resize(),BABYLON.Animation.AllowMatricesInterpolation=!0,o(4,p=new BABYLON.Scene(f)),D=p.clearColor;let t=new BABYLON.ArcRotateCamera("camera1",Math.PI/2,Math.PI/2,3,new BABYLON.Vector3(0,1,0),p);t.attachControl(e,!0),t.lowerRadiusLimit=1.2,t.upperRadiusLimit=8,t.wheelDeltaPercentage=.01,t.onViewMatrixChangedObservable.add((()=>{z({type:"camera",position:t.position,rotation:t.rotation})}));let r=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,1,0),p);r.intensity=.6,r.specular=BABYLON.Color3.Black();let i=new BABYLON.DirectionalLight("dir01",new BABYLON.Vector3(0,-.5,-1),p);i.position=new BABYLON.Vector3(0,5,5);let a=new BABYLON.ShadowGenerator(1024,i);a.useBlurExponentialShadowMap=!0,a.blurKernel=32;var c=new BABYLON.GridMaterial("groundMaterial",p);c.majorUnitFrequency=1,c.minorUnitVisibility=.1,c.gridRatio=1,c.backFaceCulling=!1,c.mainColor=new BABYLON.Color3(0,0,0),c.lineColor=new BABYLON.Color3(0,0,0),c.opacity=.2,BABYLON.Mesh.CreateGround("ground1",20,20,2,p).material=c,BABYLON.SceneLoader.ImportMesh("",n+"data/","dummy3.glb",p,(function(e,t,n){p.stopAllAnimations();var r=n[0],i=e[1];o(23,b=e),I(b,s),p.meshes.forEach((e=>{e.isPickable=!1})),a.addShadowCaster(p.meshes[0],!0);for(var c=0;c<e.length;c++)e[c].receiveShadows=!1;Q(P),function(e,t){t.bones.forEach((function(t){if(!t.name.includes("neutral")&&!t.name.includes("Skelett")){let o=B[t.name],n="#FF0000";if(!(t.name.includes("Wrist")||t.name.includes("Shoulder")||t.name.includes("Finger")||t.name.includes("Thumb"))){const r=BABYLON.MeshBuilder.CreateSphere("joint_"+t.name,{segments:4,diameter:.04},p);r.attachToBone(t,e),r.bone=t,r.renderingGroupId=2,o&&o.jointColor&&(n=o.jointColor),r.material=new BABYLON.StandardMaterial("joint"),r.material.diffuseColor=BABYLON.Color3.FromHexString(n),r.renderForAI=!0,r.aiColor=BABYLON.Color3.FromHexString(n)}let r,i=[];t.children&&t.children[0]&&(r=t.children[0],i=[new BABYLON.Vector3(0,0,0),r.position]),n="#ffffff",o&&o.boneColor&&(n=o.boneColor);let a,s=function(e,t){let o=[];for(let n=0;n<t;n++){let r=n/t*Math.PI*2,i=e*Math.cos(r),a=e*Math.sin(r);o.push(new BABYLON.Vector3(i,a,0))}return o}(.015,5);!i.length||t.name.includes("Finger")||t.name.includes("Thumb")||t.name.includes("Hand")||(a=new BABYLON.MeshBuilder.ExtrudeShape("bone_"+t.name,{shape:s,closeShape:!0,path:i,sideOrientation:BABYLON.Mesh.DOUBLESIDE,updatable:!0},p),a.renderingGroupId=2,a.bone=t,a.child=r,a.attachToBone(t,e),a.material=new BABYLON.StandardMaterial("bone"),a.renderForAI=!0,a.aiColor=BABYLON.Color3.FromHexString(n),a.material.diffuseColor=BABYLON.Color3.FromHexString(n))}}))}(i,r),function(e,t){R=BABYLON.MeshBuilder.CreateBox("box",{height:.06,width:.06,depth:.06}),R.renderingGroupId=2,R.isVisible=!1,O=t.bones[0];let n=new BABYLON.UtilityLayerRenderer(p);y=new BABYLON.PositionGizmo(n),x=new BABYLON.RotationGizmo(n),v=new BABYLON.ScaleGizmo(n),y.xGizmo.dragBehavior.onDragEndObservable.add((()=>{z({type:"position",axis:"x"})})),y.yGizmo.dragBehavior.onDragEndObservable.add((()=>{z({type:"position",axis:"y"})})),y.zGizmo.dragBehavior.onDragEndObservable.add((()=>{z({type:"position",axis:"z"})})),x.xGizmo.dragBehavior.onDragEndObservable.add((()=>{V=!1,R.isVisible=!1,z({type:"rotation",axis:"x"})})),x.yGizmo.dragBehavior.onDragEndObservable.add((()=>{V=!1,R.isVisible=!1,z({type:"rotation",axis:"y"})})),x.zGizmo.dragBehavior.onDragEndObservable.add((()=>{V=!1,R.isVisible=!1,z({type:"rotation",axis:"z"})})),x.xGizmo.dragBehavior.onDragStartObservable.add((()=>{F="x",R.rotation[F],V=!0})),x.yGizmo.dragBehavior.onDragStartObservable.add((()=>{F="y",R.rotation[F],V=!0})),x.zGizmo.dragBehavior.onDragStartObservable.add((()=>{F="z",R.rotation[F],V=!0})),v.xGizmo.dragBehavior.onDragEndObservable.add((()=>{z({type:"scale",axis:"x"})})),v.yGizmo.dragBehavior.onDragEndObservable.add((()=>{z({type:"scale",axis:"y"})})),v.zGizmo.dragBehavior.onDragEndObservable.add((()=>{z({type:"scale",axis:"z"})}));let r=new BABYLON.AxisScaleGizmo(new BABYLON.Vector3(0,1,0),BABYLON.Color3.FromHexString("#00b894"),n);r.attachedNode=null,x.updateGizmoRotationToMatchAttachedMesh=!0,x.updateGizmoPositionToMatchAttachedMesh=!0,y.updateGizmoPositionToMatchAttachedMesh=!0,G="",o(4,p.onPointerDown=function(){const e=p.pick(this.pointerX,this.pointerY);if(e.hit&&"edit_skeleton"===k){if(e.pickedMesh.name.includes("joint_")){let a=e.pickedMesh;if(a.name===G)x.attachedNode=null,G="";else{G=a.name,x.jointMesh=a,A=a.bone.getTransformNode(),R.position=a.bone.getTransformNode().absolutePosition,R.isVisible=!1,x.attachedNode=A,r.attachedNode=null;var t=A.getWorldMatrix(),o=new BABYLON.Quaternion,n=new BABYLON.Vector3,i=new BABYLON.Vector3;t.decompose(i,o,n);let e=o.toEulerAngles();R.rotation=e}}e.pickedMesh.name.includes("bone_")}},p)}((e[1],e[2]),r),f.hideLoadingUI(),function(e){e.runRenderLoop((function(){p&&p.activeCamera&&(V&&"edit_skeleton"===k&&R.rotation[F],p.render())}))}(f),window.in_3d_canvas_init=!1}))}(U)}),0),()=>{c&&o(5,c.data=N(),c)}),h().$$.on_mount.push(m);let{scene:p}=t,b=[];let $=function(){return new Promise((e=>{setTimeout((()=>{e("")}),100)}))};let B={top:{boneColor:"#00009b",jointColor:"#9e323a"},"Shoulder L":{boneColor:"#993300",jointColor:""},"Shoulder R":{boneColor:"#990000",jointColor:""},"UpperArm L":{boneColor:"#669900",jointColor:"#349c00"},"UpperArm R":{boneColor:"#996600",jointColor:"#916100"},"LowerArm L":{boneColor:"#339900",jointColor:"#008400"},"LowerArm R":{boneColor:"#999900",jointColor:"#9a9900"},"Wrist L":{boneColor:"#009999",jointColor:""},"Wrist R":{boneColor:"#009900",jointColor:""},"UpperLeg L":{boneColor:"#006699",jointColor:"#003194"},"UpperLeg R":{boneColor:"#009933",jointColor:"#00a767"},"LowerLeg L":{boneColor:"#003399",jointColor:"#0011b3"},"LowerLeg R":{boneColor:"#009966",jointColor:"#00a49d"},"Eye L":{boneColor:"#a200a3",jointColor:"#9f002e"},"Eye R":{boneColor:"#320099",jointColor:"#9f002e"},"Ear L":{boneColor:"#990066",jointColor:"#980098"},"Ear R":{boneColor:"#660099",jointColor:"#6a009f"},"Delete L":{boneColor:"",jointColor:"#980032"},"Delete R":{boneColor:"",jointColor:"#9c006a"},"Hand L":{boneColor:"",jointColor:"#009933"},"Hand R":{boneColor:"",jointColor:"#669900"},"Foot L":{boneColor:"",jointColor:"#330098"},"Foot R":{boneColor:"",jointColor:"#006598"}};let w={joints:{},root:{}};function _(){return function(){const e=BABYLON.Vector3.Zero(),t=BABYLON.Vector3.Zero(),o=BABYLON.Quaternion.Zero();O.getLocalMatrix().decompose(t,o,e),w.root={scaling:t.clone(),rotationQ:o.clone(),position:e.clone()};for(let n of p.meshes)n.name.includes("joint_")&&(n.bone.getLocalMatrix().decompose(t,o,e),w.joints[n.name]={scaling:t.clone(),rotationQ:o.clone(),position:e.clone()})}(),[JSON.parse(JSON.stringify(w))]}function C(e){w=e[0],function(){let e=O.getTransformNode(),t=w.root;e.rotationQuaternion=new BABYLON.Quaternion(t.rotationQ._x,t.rotationQ._y,t.rotationQ._z,t.rotationQ._w),e.position=new BABYLON.Vector3(t.position._x,t.position._y,t.position._z),e.scaling=new BABYLON.Vector3(t.scaling._x,t.scaling._y,t.scaling._z);for(let o of p.meshes)if(o.name.includes("joint_")){let n=o.bone;e=n.getTransformNode(),t=w.joints[o.name],e.rotationQuaternion=new BABYLON.Quaternion(t.rotationQ._x,t.rotationQ._y,t.rotationQ._z,t.rotationQ._w),e.position=new BABYLON.Vector3(t.position._x,t.position._y,t.position._z),e.scaling=new BABYLON.Vector3(t.scaling._x,t.scaling._y,t.scaling._z),e.rotationQuaternion?n.rotationQuaternion=e.rotationQuaternion:n.rotation=e.rotation,n.scaling=e.scaling}}()}function N(){let e={},t=p.activeCamera;return e.position=JSON.parse(JSON.stringify(t.position)),e.rotation=JSON.parse(JSON.stringify(t.rotation)),{cameraInfo:e,poseInfo:_()}}async function L(){let e=k;M(""),await $();let t=U.toDataURL();return M(e),t}let x,y,v,O,A,{mode:k=""}=t;function M(e){"edit_skeleton"===e&&x&&y&&(x&&(x.attachedNode=null),y&&(y.attachedNode=null),v&&(v.attachedNode=null)),"move_rotate"===e&&O&&(x.attachedNode=O.getTransformNode(),y.attachedNode=O.getTransformNode(),v&&(v.attachedNode=null)),"scale"===e&&x&&y&&(x.attachedNode=null,y.attachedNode=null,v&&(v.attachedNode=O.getTransformNode())),""===e&&x&&y&&(x.attachedNode=null,y.attachedNode=null,v.attachedNode=null)}function z(e){r.dispatchEvent(new CustomEvent("change",{detail:e}))}let R,G,F,V=!1;let D,{background_type:P="transparent"}=t,T=null;function Q(e="grey"){p&&("transparent"===e&&(T&&(T.dispose(),T=null),o(4,p.clearColor=new BABYLON.Color4(0,0,0,0),p)),"grey"===e&&(T||(T=p.createDefaultEnvironment({enableGroundShadow:!0}),T.setMainColor(BABYLON.Color3.Gray()),T.ground.position.y+=.01),o(4,p.clearColor=D,p)),"black"===e&&(T&&(T.dispose(),T=null),o(4,p.clearColor=new BABYLON.Color4(0,0,0,255),p)))}let{canvas:U}=t;return e.$$set=e=>{"width"in e&&o(1,i=e.width),"height"in e&&o(2,a=e.height),"external_scene_storage"in e&&o(5,c=e.external_scene_storage),"show_character"in e&&o(3,l=e.show_character),"camera_behaviour"in e&&o(6,d=e.camera_behaviour),"scene"in e&&o(4,p=e.scene),"mode"in e&&o(16,k=e.mode),"background_type"in e&&o(20,P=e.background_type),"canvas"in e&&o(0,U=e.canvas)},e.$$.update=()=>{e.$$.dirty[0],12582920&e.$$.dirty[0]&&(o(22,s="human"==l),I(b,s)),1048576&e.$$.dirty[0]&&P&&Q(P),65536&e.$$.dirty[0]&&k&&M(k),81&e.$$.dirty[0]&&p&&(d||p.activeCamera.attachControl(U,!0),"lock"===d&&p.activeCamera.detachControl())},[U,i,a,l,p,c,d,async function(e){return"version"===e?new Promise((e=>{e(j)})):await S.getInfo(e,Y)},u,async function(){M("");let e=P;Q("black");let t=l;o(3,l="");for(let e of p.meshes)e.renderForAI&&(e.material.disableLighting=!0,e.material.emissiveColor=e.aiColor);await $(),o(3,l=t);let n=U.toDataURL();for(let e of p.meshes)e.renderForAI&&(e.material.disableLighting=!1,e.material.emissiveColor=BABYLON.Color3.FromHexString("#000000"));return Q(e),n},_,C,async function(){let e=await L(),t={},o=p.activeCamera;return t.position=JSON.parse(JSON.stringify(o.position)),t.rotation=JSON.parse(JSON.stringify(o.rotation)),{cameraInfo:t,poseInfo:_(),image:e}},N,function(e){if(O){C(e.poseInfo);let t=p.activeCamera;t.position=e.cameraInfo.position,t.rotation=e.cameraInfo.rotation}else setTimeout((()=>{C(e.poseInfo);let t=p.activeCamera;t.position=e.cameraInfo.position,t.rotation=e.cameraInfo.rotation}),500)},L,k,M,E,function(e,t){let o=new BABYLON.Debug.SkeletonViewer(t,e,p);o.isEnabled=!0,o.color=BABYLON.Color3.Red()},P,Q,s,b,function(e){g[e?"unshift":"push"]((()=>{U=e,o(0,U)}))}]}class z extends O{constructor(e){super();const t=document.createElement("style");t.textContent=".canvas{width:100%;height:100%}*{box-sizing:border-box}",this.shadowRoot.appendChild(t),v(this,{target:this.shadowRoot,props:l(this.attributes),customElement:!0},M,k,i,{width:1,height:2,external_scene_storage:5,show_character:3,camera_behaviour:6,getInfo:7,version:8,scene:4,renderForAI:9,getPose:10,setPose:11,getScene:12,getSceneNoImage:13,setScene:14,renderNormal:15,mode:16,setMode:17,getPoseFromImage:18,addSkeletonViewer:19,background_type:20,setBackground:21,canvas:0},null,[-1,-1]),e&&(e.target&&a(e.target,this,e.anchor),e.props&&(this.$set(e.props),C()))}static get observedAttributes(){return["width","height","external_scene_storage","show_character","camera_behaviour","getInfo","version","scene","renderForAI","getPose","setPose","getScene","getSceneNoImage","setScene","renderNormal","mode","setMode","getPoseFromImage","addSkeletonViewer","background_type","setBackground","canvas"]}get width(){return this.$$.ctx[1]}set width(e){this.$$set({width:e}),C()}get height(){return this.$$.ctx[2]}set height(e){this.$$set({height:e}),C()}get external_scene_storage(){return this.$$.ctx[5]}set external_scene_storage(e){this.$$set({external_scene_storage:e}),C()}get show_character(){return this.$$.ctx[3]}set show_character(e){this.$$set({show_character:e}),C()}get camera_behaviour(){return this.$$.ctx[6]}set camera_behaviour(e){this.$$set({camera_behaviour:e}),C()}get getInfo(){return this.$$.ctx[7]}get version(){return this.$$.ctx[8]}get scene(){return this.$$.ctx[4]}set scene(e){this.$$set({scene:e}),C()}get renderForAI(){return this.$$.ctx[9]}get getPose(){return this.$$.ctx[10]}get setPose(){return this.$$.ctx[11]}get getScene(){return this.$$.ctx[12]}get getSceneNoImage(){return this.$$.ctx[13]}get setScene(){return this.$$.ctx[14]}get renderNormal(){return this.$$.ctx[15]}get mode(){return this.$$.ctx[16]}set mode(e){this.$$set({mode:e}),C()}get setMode(){return this.$$.ctx[17]}get getPoseFromImage(){return E}get addSkeletonViewer(){return this.$$.ctx[19]}get background_type(){return this.$$.ctx[20]}set background_type(e){this.$$set({background_type:e}),C()}get setBackground(){return this.$$.ctx[21]}get canvas(){return this.$$.ctx[0]}set canvas(e){this.$$set({canvas:e}),C()}}return customElements.define("fds-pose-editor",z),z}();
//# sourceMappingURL=fds-pose-editor.js.map
